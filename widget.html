<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hochkar Buchungs-Widget</title>
  <style>
    /* dein vorhandenes CSS bleibt unverändert */
    *,*::before,*::after{box-sizing:border-box;}
    body{margin:0;background:#f4f6f9;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;display:flex;align-items:flex-start;justify-content:center;padding:24px;}
    #hk-widget{max-width:720px;width:100%;background:#fff;border:1px solid #e6e6e9;border-radius:14px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.08);}
    .hk-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px;}
    .hk-title{margin:0;font-size:22px;font-weight:800;line-height:1.2;}
    .hk-subtitle{color:#6b7280;font-size:14px;}
    .hk-logo{height:40px;width:auto;object-fit:contain;}
    .hk-body{display:flex;gap:16px;flex-wrap:wrap;min-width:0;}
    .hk-section{flex:1 1 300px;border:1px solid #ececf1;border-radius:12px;padding:14px;min-width:0;}
    .hk-section-title{font-weight:600;margin-bottom:10px;}
    .hk-daterow{display:grid;grid-template-columns:minmax(0,1fr) minmax(0,1fr);gap:10px;align-items:end;width:100%;}
    .hk-datefield label{display:block;font-size:12px;color:#6b7280;margin:0 0 4px 0;line-height:1.2;}
    input[type="date"]{display:block;width:100%;padding:10px;border:1px solid #d1d5db;border-radius:12px;background:#fff;color:#111827;font-size:14px;}
    .hk-hint{margin-top:8px;color:#6b7280;font-size:12px;}
    .hk-duration{margin-top:8px;font-size:13px;color:#111827;font-weight:600;}
    .hk-counters{display:flex;flex-direction:column;gap:8px;}
    .hk-counter-row{display:grid;grid-template-columns:40px 1fr auto;gap:10px;align-items:center;border:1px solid #ececf1;border-radius:12px;padding:12px;}
    .hk-count{font-size:24px;font-weight:800;color:#111827;min-width:28px;text-align:center;}
    .hk-label{font-weight:700;}
    .hk-sublabel{color:#6b7280;font-size:12px;}
    .hk-actions{display:flex;gap:8px;}
    .hk-btn{width:36px;height:36px;border-radius:10px;border:1px solid #d1d5db;background:#fff;font-size:18px;line-height:34px;text-align:center;cursor:pointer;}
    .hk-btn:disabled{opacity:.35;cursor:not-allowed;}
    .hk-plus{font-weight:800;}
    .hk-error{margin-top:8px;color:#b00020;font-size:14px;}
    .hk-footer{margin-left:auto;margin-top:8px;}
    .hk-cta{display:inline-block;padding:12px 18px;border-radius:12px;border:0;background:#154696;color:#fff;font-weight:700;cursor:pointer;min-width:140px;}
    .hk-cta:hover{background:#103874;}
    @media(max-width:510px){.hk-daterow{grid-template-columns:1fr}.hk-logo{height:32px}}
  </style>
</head>
<body>
  <div id="hk-widget">
    <div class="hk-header">
      <div class="hk-titles">
        <h3 class="hk-title"></h3>
        <div class="hk-subtitle"></div>
      </div>
      <img class="hk-logo" src="https://www.hochkar.com/portal/dist/images/branding/hochkar/logo.db33c945.png" alt="">
    </div>

    <div class="hk-body">
      <div class="hk-section">
        <div class="hk-section-title" id="i18n-date-section"></div>

        <div class="hk-daterow">
          <div class="hk-datefield">
            <label for="hk-start" id="i18n-from"></label>
            <input type="date" id="hk-start" required>
          </div>
          <div class="hk-datefield">
            <label for="hk-end" id="i18n-to"></label>
            <input type="date" id="hk-end" disabled>
          </div>
        </div>

        <div class="hk-hint" id="i18n-hint"></div>
        <div class="hk-duration" id="hk-duration"></div>
      </div>

      <div class="hk-section hk-counters">
        <div class="hk-counter-row">
          <div class="hk-count" id="hk-adults-count">1</div>
          <div class="hk-labels">
            <div class="hk-label" id="i18n-adult"></div>
            <div class="hk-sublabel" id="i18n-adult-age"></div>
          </div>
          <div class="hk-actions">
            <button class="hk-btn hk-minus" id="hk-adults-minus" type="button">–</button>
            <button class="hk-btn hk-plus" id="hk-adults-plus" type="button">+</button>
          </div>
        </div>

        <div class="hk-counter-row">
          <div class="hk-count" id="hk-kids-count">0</div>
          <div class="hk-labels">
            <div class="hk-label" id="i18n-child"></div>
            <div class="hk-sublabel" id="i18n-child-age"></div>
          </div>
          <div class="hk-actions">
            <button class="hk-btn hk-minus" id="hk-kids-minus" type="button" disabled>–</button>
            <button class="hk-btn hk-plus" id="hk-kids-plus" type="button">+</button>
          </div>
        </div>
      </div>

      <div id="hk-error" class="hk-error" style="display:none"></div>
      <div class="hk-footer"><button id="hk-submit" class="hk-cta" type="button"></button></div>
    </div>
  </div>

  <script>
  // --- Sprachsteuerung ----------------------------------------------------
  const I18N = {
    de: {
      title:"Skitickets", subtitle:"Stunden-, Tages- & Mehrtagestickets",
      date_section:"Datumsbereich", from:"Von", to:"Bis",
      hint:"Buchbar sind 1–6 Tage. „Bis“ leer lassen, um 1 Tag zu buchen.",
      selected_duration:"Ausgewählte Dauer: {d} {day}",
      day_one:"Tag", day_other:"Tage",
      adult:"Erwachsen", adult_age:"Alter ab 16 Jahren",
      child:"Kind", child_age:"Alter zwischen 6 und 15 Jahren",
      error_start:"Bitte ein Startdatum wählen.",
      error_duration:"Bitte eine Dauer zwischen 1 und 6 Tagen wählen.",
      cta:"Weiter", logo_alt:"Hochkar Logo", date_unset:"Ausgewählte Dauer: –"
    },
    en: {
      title:"Ski tickets", subtitle:"Hourly, Day & Multi-day tickets",
      date_section:"Date range", from:"From", to:"To",
      hint:"Bookable for 1–6 days. Leave “To” empty to book 1 day.",
      selected_duration:"Selected duration: {d} {day}",
      day_one:"day", day_other:"days",
      adult:"Adult", adult_age:"Age 16 and over",
      child:"Child", child_age:"Age 6 to 15",
      error_start:"Please select a start date.",
      error_duration:"Please choose a duration between 1 and 6 days.",
      cta:"Continue", logo_alt:"Hochkar logo", date_unset:"Selected duration: –"
    }
  };

  function detectLang(){
    const qp = new URLSearchParams(location.search).get('lang');
    if(qp) return qp.split('-')[0].toLowerCase();
    const nav=(navigator.language||'de').toLowerCase();
    return nav.startsWith('en')?'en':'de';
  }
  let LANG=detectLang();
  document.documentElement.lang=LANG;
  function t(k){return (I18N[LANG]&&I18N[LANG][k])||(I18N.de[k]||k);}
  function plural(n,one,other){return n===1?t(one):t(other);}
  function applyI18n(){
    document.querySelector('.hk-title').textContent=t('title');
    document.querySelector('.hk-subtitle').textContent=t('subtitle');
    document.querySelector('.hk-logo').alt=t('logo_alt');
    document.getElementById('i18n-date-section').textContent=t('date_section');
    document.getElementById('i18n-from').textContent=t('from');
    document.getElementById('i18n-to').textContent=t('to');
    document.getElementById('i18n-hint').textContent=t('hint');
    document.getElementById('i18n-adult').textContent=t('adult');
    document.getElementById('i18n-adult-age').textContent=t('adult_age');
    document.getElementById('i18n-child').textContent=t('child');
    document.getElementById('i18n-child-age').textContent=t('child_age');
    document.getElementById('hk-submit').textContent=t('cta');
    document.getElementById('hk-duration').textContent=t('date_unset');
  }
  document.addEventListener('DOMContentLoaded',applyI18n);
  </script>

  <script>
  // --- Rest deiner Logik bleibt wie gehabt, hier gekürzt ---
  (function(){
    const PRODUCT_URL="https://shop.hochkar.com/products/skitickets";
    const MAX_DAYS=6;
    const $=id=>document.getElementById(id);
    const elStart=$("hk-start"),elEnd=$("hk-end"),err=$("hk-error"),dur=$("hk-duration");
    const adultsCount=$("hk-adults-count"),kidsCount=$("hk-kids-count");
    let adults=1,kids=0;
    function setCount(type,v){
      v=Math.max(0,Math.min(99,v|0));
      if(type==="adults"){adults=v;adultsCount.textContent=v;}
      else{kids=v;kidsCount.textContent=v;$("hk-kids-minus").disabled=v<=0;}
    }
    $("hk-adults-minus").onclick=()=>setCount("adults",adults-1);
    $("hk-adults-plus").onclick=()=>setCount("adults",adults+1);
    $("hk-kids-minus").onclick=()=>setCount("kids",kids-1);
    $("hk-kids-plus").onclick=()=>setCount("kids",kids+1);

    function addDaysISO(iso,n){const d=new Date(iso);d.setDate(d.getDate()+n);return d.toISOString().split("T")[0];}
    function diffDays(s,e){return Math.round((new Date(e)-new Date(s))/86400000)+1;}
    function clampDate(v,min,max){if(!v)return v;if(min&&v<min)return min;if(max&&v>max)return max;return v;}
    function updateDuration(){
      const s=elStart.value;const e=elEnd.value||s;
      if(!s){dur.textContent=t('date_unset');return;}
      const d=Math.max(1,Math.min(MAX_DAYS,diffDays(s,e)));
      dur.textContent=t('selected_duration')
        .replace('{d}',d)
        .replace('{day}',plural(d,'day_one','day_other'));
    }
    ["input","change","blur"].forEach(evt=>{
      elStart.addEventListener(evt,()=>{
        if(!elStart.value){elEnd.value="";elEnd.disabled=true;dur.textContent=t('date_unset');return;}
        elEnd.disabled=false;elEnd.min=elStart.value;elEnd.max=addDaysISO(elStart.value,MAX_DAYS-1);
        elEnd.value=clampDate(elEnd.value||elStart.value,elEnd.min,elEnd.max);
        updateDuration();
      });
      elEnd.addEventListener(evt,updateDuration);
    });

    $("hk-submit").onclick=()=>{
      err.style.display="none";
      const s=elStart.value;if(!s){err.textContent=t('error_start');err.style.display="block";return;}
      const e=elEnd.value||s;const d=diffDays(s,e);
      if(d<1||d>MAX_DAYS){err.textContent=t('error_duration');err.style.display="block";return;}
      const from=new Date(s+"T00:00:00"),to=new Date(e+"T23:59:59.999");
      const alloc=[];if(adults>0)alloc.push({kind:"anonymous",quantity:adults,personType:"adult"});
      if(kids>0)alloc.push({kind:"anonymous",quantity:kids,personType:"child"});
      const formState={validity:{from:from.toISOString(),to:to.toISOString()},allocation:{kind:"persontype",values:alloc},attributes:{duration:"1d"}};
      window.open(PRODUCT_URL+"?formState="+encodeURIComponent(JSON.stringify(formState)),"_blank","noopener");
    };
    setCount("adults",1);setCount("kids",0);
  })();

  // --- iFrame-Auto-Resize bleibt unverändert ---
  (function(){
    var ROOT=document.getElementById('hk-widget');var BODY_PADDING=48;
    function calcHeight(){return Math.ceil(ROOT.getBoundingClientRect().height)+BODY_PADDING;}
    function post(reason){try{parent.postMessage({type:'HKWIDGET_HEIGHT',height:calcHeight(),reason:reason||''},'*');}catch(e){}}
    window.addEventListener('load',()=>post('load'));window.addEventListener('resize',()=>post('resize'));
    var mo=new MutationObserver(()=>{clearTimeout(post._t);post._t=setTimeout(()=>post('mut'),50);});
    mo.observe(ROOT,{subtree:true,childList:true,attributes:true});
    setTimeout(()=>post('delay300'),300);setTimeout(()=>post('delay1200'),1200);
  })();
  </script>
</body>
</html>
